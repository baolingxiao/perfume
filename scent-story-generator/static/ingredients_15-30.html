<!--
ğŸŒ¸ é¦™æ°´å·¥åŠ - é¦™æ–™é€‰æ‹©é¡µé¢
Last updated: 2025-07-01 15:27
Author: Perfume Workshop Team
Description: é¦™æ–™é€‰æ‹©é¡µé¢ï¼Œå±•ç¤ºå„ç§ç±»å‹çš„é¦™æ–™ä¾›ç”¨æˆ·é€‰æ‹©ï¼ˆæœé¦™ã€èŠ±é¦™ã€æœ¨é¦™ï¼‰
-->
<!--
Last updated: 2024-03-19 15:30
Author: Perfume Workshop Team
Description: é¦™æ–™é€‰æ‹©é¡µé¢ï¼Œå±•ç¤ºå„ç§ç±»å‹çš„é¦™æ–™ä¾›ç”¨æˆ·é€‰æ‹©
-->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é€‰æ‹©é¦™æ–™ - é¦™æ°´å·¥åŠ</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/base_15-30.css?v=42">
    <link rel="stylesheet" href="css/ingredients_15-30.css?v=42">
    <style>
        .selected-list {
            display: flex;
            gap: 16px;
            justify-content: center;
            align-items: center;
            margin-top: 8px;
        }
        .selected-list .selected-img {
            width: 64px;
            height: 64px;
            object-fit: cover;
            background: #000;
            border-radius: 50%;
            clip-path: circle(50% at 50% 50%);
            border: 2px solid #fff;
            box-shadow: 0 2px 8px rgba(0,0,0,0.12);
            transition: all 0.3s ease;
        }
        .selected-list .selected-img:hover {
            transform: scale(1.1);
            border-color: #007bff;
            box-shadow: 0 4px 16px rgba(0,123,255,0.3);
        }
        .selected-list .placeholder {
            width: 64px;
            height: 64px;
            border-radius: 50%;
            background: #eee;
            border: 2px dashed #ccc;
        }
        
        /* é¦™æ°´æ•…äº‹åŒºåŸŸæ ·å¼ */
        .perfume-story-section {
            margin-top: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            border: 1px solid #dee2e6;
        }
        
        .perfume-story-section h3 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 1.2em;
            display: flex;
            align-items: center;
        }
        
        .perfume-story-section h3::before {
            content: "ğŸŒ¸";
            margin-right: 8px;
            font-size: 1.1em;
        }
        
        .story-placeholder {
            text-align: center;
            color: #6c757d;
            font-style: italic;
            padding: 20px;
        }
        
        .story-loading {
            text-align: center;
            padding: 30px;
        }
        
        .story-loading h3 {
            color: #495057;
            margin-bottom: 10px;
        }
        
        .story-loading p {
            color: #6c757d;
            margin-bottom: 20px;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .story-result {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .story-result h3 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 1.3em;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 10px;
        }
        
        .story-content {
            line-height: 1.8;
            color: #495057;
            margin-bottom: 20px;
            text-align: justify;
        }
        
        .story-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-top: 1px solid #e9ecef;
            font-size: 0.9em;
            color: #6c757d;
        }
        
        .story-error {
            text-align: center;
            padding: 30px;
            color: #dc3545;
        }
        
        .story-error h3 {
            color: #dc3545;
            margin-bottom: 10px;
        }
        
        .perfume-story-btn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            margin-left: 10px;
        }
        
        .perfume-story-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
        }

    </style>
</head>
<body>
    <nav class="main-nav">
        <div class="nav-content">
            <div class="logo">é¦™æ°´å·¥åŠ</div>
            <ul class="nav-links">
                <li><a href="index_15-30.html">é¦–é¡µ</a></li>
                <li><a href="#about">å…³äºæˆ‘ä»¬</a></li>
                <li><a href="#contact">è”ç³»æ–¹å¼</a></li>
            </ul>
        </div>
    </nav>

    <main class="ingredients-page">
        <h1 class="page-title">é€‰æ‹©é¦™æ–™</h1>
        
        <!-- é¦™æ–™ç±»å‹é€‰æ‹©å™¨ -->
        <div class="fragrance-types">
            <button class="type-btn active" data-type="all">å…¨éƒ¨</button>
            <button class="type-btn" data-type="fruit">æœé¦™</button>
            <button class="type-btn" data-type="floral">èŠ±é¦™</button>
            <button class="type-btn" data-type="woody">æœ¨é¦™</button>
        </div>

        <!-- é¦™è°ƒé€‰æ‹©å™¨ -->
        <div class="note-selector">
            <button class="note-btn active" data-note="all">å…¨éƒ¨</button>
            <button class="note-btn" data-note="top">å‰è°ƒ</button>
            <button class="note-btn" data-note="middle">ä¸­è°ƒ</button>
            <button class="note-btn" data-note="base">å°¾è°ƒ</button>
        </div>

        <!-- é¦™æ–™å±•ç¤ºåŒºåŸŸ -->
        <div class="ingredients-grid">
            <!-- æœé¦™éƒ¨åˆ† -->
            <div class="ingredient-category" id="fruit">
                <!-- æŸ‘æ©˜ç±» - å‰è°ƒ -->
                <div class="ingredient-item" data-href="é¦™æŸ æª¬.html" data-note="top" style="text-decoration:none;">
                    <img src="images/ingredients/é¦™æŸ æª¬.jpeg" alt="é¦™æŸ æª¬ Bergamot" style="width:100%;height:80%;object-fit:cover;display:block;">
                    <div class="ingredient-bottom"></div>
                    <h3>é¦™æŸ æª¬<br><span class='en'>Bergamot</span></h3>
                </div>
                <div class="ingredient-item" data-href="é’æŸ .html" data-note="top" style="text-decoration:none;">
                    <img src="images/ingredients/é’æŸ .jpeg" alt="é’æŸ  Lime" style="width:100%;height:80%;object-fit:cover;display:block;">
                    <div class="ingredient-bottom"></div>
                    <h3>é’æŸ <br><span class='en'>Lime</span></h3>
                </div>
                <div class="ingredient-item" data-href="æ©™å­.html" data-note="top" style="text-decoration:none;">
                    <img src="images/ingredients/æ©™å­.jpeg" alt="æ©™å­ Orange" style="width:100%;height:80%;object-fit:cover;display:block;">
                    <div class="ingredient-bottom"></div>
                    <h3>æ©™å­<br><span class='en'>Orange</span></h3>
                </div>
                <div class="ingredient-item" data-href="è¡€æ©™.html" data-note="top" style="text-decoration:none;">
                    <img src="images/ingredients/è¡€æ©™.jpeg" alt="è¡€æ©™ Blood Orange" style="width:100%;height:80%;object-fit:cover;display:block;">
                    <div class="ingredient-bottom"></div>
                    <h3>è¡€æ©™<br><span class='en'>Blood Orange</span></h3>
                </div>
                <div class="ingredient-item" data-href="æŸšå­.html" data-note="top" style="text-decoration:none;">
                    <img src="images/ingredients/æŸšå­.jpeg" alt="æŸšå­ Grapefruit" style="width:100%;height:80%;object-fit:cover;display:block;">
                    <div class="ingredient-bottom"></div>
                    <h3>æŸšå­<br><span class='en'>Grapefruit</span></h3>
                </div>
                <div class="ingredient-item" data-href="æŸ‘æ©˜.html" data-note="top" style="text-decoration:none;">
                    <img src="images/ingredients/æŸ‘æ©˜.jpeg" alt="æŸ‘æ©˜ Mandarin Orange" style="width:100%;height:80%;object-fit:cover;display:block;">
                    <div class="ingredient-bottom"></div>
                    <h3>æŸ‘æ©˜<br><span class='en'>Mandarin Orange</span></h3>
                </div>
                <div class="ingredient-item" data-href="é‡‘æ¡”.html" data-note="top" style="text-decoration:none;">
                    <img src="images/ingredients/é‡‘æ¡”.jpg" alt="é‡‘æ¡” Kumquat" style="width:100%;height:80%;object-fit:cover;display:block;">
                    <div class="ingredient-bottom"></div>
                    <h3>é‡‘æ¡”<br><span class='en'>Kumquat</span></h3>
                </div>

                <!-- æ¸…æ–°æœé¦™ - å‰è°ƒ/ä¸­è°ƒ -->
                <div class="ingredient-item" data-href="è‹¹æœ.html" data-note="top" style="text-decoration:none;">
                    <img src="images/ingredients/è‹¹æœ.jpeg" alt="è‹¹æœ Apple" style="width:100%;height:80%;object-fit:cover;display:block;">
                    <div class="ingredient-bottom"></div>
                    <h3>è‹¹æœ<br><span class='en'>Apple</span></h3>
                </div>
                <div class="ingredient-item" data-href="é’è‹¹æœ.html" data-note="top" style="text-decoration:none;">
                    <img src="images/ingredients/é’è‹¹æœ.jpeg" alt="é’è‹¹æœ Green Apple" style="width:100%;height:80%;object-fit:cover;display:block;">
                    <div class="ingredient-bottom"></div>
                    <h3>é’è‹¹æœ<br><span class='en'>Green Apple</span></h3>
                </div>
                <div class="ingredient-item" data-href="æ¢¨.html" data-note="top" style="text-decoration:none;">
                    <img src="images/ingredients/æ¢¨.jpeg" alt="æ¢¨ Pear" style="width:100%;height:80%;object-fit:cover;display:block;">
                    <div class="ingredient-bottom"></div>
                    <h3>æ¢¨<br><span class='en'>Pear</span></h3>
                </div>

                <!-- ç”œç¾æœé¦™ - ä¸­è°ƒ -->
                <div class="ingredient-item" data-href="æ¡ƒå­.html" data-note="middle" style="text-decoration:none;">
                    <img src="images/ingredients/æ¡ƒå­.jpeg" alt="æ¡ƒå­ Peach" style="width:100%;height:80%;object-fit:cover;display:block;">
                    <div class="ingredient-bottom"></div>
                    <h3>æ¡ƒå­<br><span class='en'>Peach</span></h3>
                </div>
                <div class="ingredient-item" data-href="æ¨±æ¡ƒ.html" data-note="middle" style="text-decoration:none;">
                    <img src="images/ingredients/æ¨±æ¡ƒ.jpeg" alt="æ¨±æ¡ƒ Cherry" style="width:100%;height:80%;object-fit:cover;display:block;">
                    <div class="ingredient-bottom"></div>
                    <h3>æ¨±æ¡ƒ<br><span class='en'>Cherry</span></h3>
                </div>
                <div class="ingredient-item" data-href="æå­.html" data-note="middle" style="text-decoration:none;">
                    <img src="images/ingredients/æå­.jpeg" alt="æå­ Plum" style="width:100%;height:80%;object-fit:cover;display:block;">
                    <div class="ingredient-bottom"></div>
                    <h3>æå­<br><span class='en'>Plum</span></h3>
                </div>
                <div class="ingredient-item" data-href="èŠ’æœ.html" data-note="middle" style="text-decoration:none;">
                    <img src="images/ingredients/èŠ’æœ.jpeg" alt="èŠ’æœ Mango" style="width:100%;height:80%;object-fit:cover;display:block;">
                    <div class="ingredient-bottom"></div>
                    <h3>èŠ’æœ<br><span class='en'>Mango</span></h3>
                </div>
                <div class="ingredient-item" data-href="æ¤°å­.html" data-note="middle" style="text-decoration:none;">
                    <img src="images/ingredients/æ¤°å­.jpeg" alt="æ¤°å­ Coconut" style="width:100%;height:80%;object-fit:cover;display:block;">
                    <div class="ingredient-bottom"></div>
                    <h3>æ¤°å­<br><span class='en'>Coconut</span></h3>
                </div>
                <div class="ingredient-item" data-href="ç™¾é¦™æœ.html" data-note="middle" style="text-decoration:none;">
                    <img src="images/ingredients/ç™¾é¦™æœ.jpeg" alt="ç™¾é¦™æœ Passion Fruit" style="width:100%;height:80%;object-fit:cover;display:block;">
                    <div class="ingredient-bottom"></div>
                    <h3>ç™¾é¦™æœ<br><span class='en'>Passion Fruit</span></h3>
                </div>
                <div class="ingredient-item" data-href="æœ¨ç“œ.html" data-note="middle" style="text-decoration:none;">
                    <img src="images/ingredients/æœ¨ç“œ.jpeg" alt="æœ¨ç“œ Papaya" style="width:100%;height:80%;object-fit:cover;display:block;">
                    <div class="ingredient-bottom"></div>
                    <h3>æœ¨ç“œ<br><span class='en'>Papaya</span></h3>
                </div>
                <div class="ingredient-item" data-href="é¦™è•‰.html" data-note="middle" style="text-decoration:none;">
                    <img src="images/ingredients/é¦™è•‰.jpeg" alt="é¦™è•‰" style="width:100%;height:80%;object-fit:cover;display:block;">
                    <div class="ingredient-bottom"></div>
                    <h3>é¦™è•‰<br><span class='en'>Banana</span></h3>
                </div>

                <!-- æµ†æœç±» - ä¸­è°ƒ -->
                <div class="ingredient-item" data-href="è‰è“.html" data-note="middle" style="text-decoration:none;">
                    <img src="images/ingredients/è‰è“.jpeg" alt="è‰è“ Strawberry" style="width:100%;height:80%;object-fit:cover;display:block;">
                    <div class="ingredient-bottom"></div>
                    <h3>è‰è“<br><span class='en'>Strawberry</span></h3>
                </div>
                <div class="ingredient-item" data-href="è¦†ç›†å­.html" data-note="middle" style="text-decoration:none;">
                    <img src="images/ingredients/è¦†ç›†å­.jpeg" alt="è¦†ç›†å­ Raspberry" style="width:100%;height:80%;object-fit:cover;display:block;">
                    <div class="ingredient-bottom"></div>
                    <h3>è¦†ç›†å­<br><span class='en'>Raspberry</span></h3>
                </div>
                <div class="ingredient-item" data-href="è“è“.html" data-note="middle" style="text-decoration:none;">
                    <img src="images/ingredients/è“è“.jpeg" alt="è“è“ Blueberry" style="width:100%;height:80%;object-fit:cover;display:block;">
                    <div class="ingredient-bottom"></div>
                    <h3>è“è“<br><span class='en'>Blueberry</span></h3>
                </div>
                <div class="ingredient-item" data-href="é»‘åŠ ä»‘.html" data-note="middle" style="text-decoration:none;">
                    <img src="images/ingredients/é»‘åŠ ä»‘.jpeg" alt="é»‘åŠ ä»‘ Blackberry" style="width:100%;height:80%;object-fit:cover;display:block;">
                    <div class="ingredient-bottom"></div>
                    <h3>é»‘åŠ ä»‘<br><span class='en'>Blackberry</span></h3>
                </div>

                <!-- é…’é¦™ç±» - å°¾è°ƒ -->
                <div class="ingredient-item" data-href="é¦™æ§Ÿç™½å…°åœ°.html" data-note="base" style="text-decoration:none;">
                    <img src="images/ingredients/é¦™æ§Ÿç™½å…°åœ°.jpeg" alt="é¦™æ§Ÿç™½å…°åœ° Champagne Cognac" style="width:100%;height:80%;object-fit:cover;display:block;">
                    <div class="ingredient-bottom"></div>
                    <h3>é¦™æ§Ÿç™½å…°åœ°<br><span class='en'>Champagne Cognac</span></h3>
                </div>
                <div class="ingredient-item" data-href="æ¨±æ¡ƒé…’.html" data-note="base" style="text-decoration:none;">
                    <img src="images/ingredients/æ¨±æ¡ƒé…’.jpeg" alt="æ¨±æ¡ƒé…’ Cherry Wine" style="width:100%;height:80%;object-fit:cover;display:block;">
                    <div class="ingredient-bottom"></div>
                    <h3>æ¨±æ¡ƒé…’<br><span class='en'>Cherry Wine</span></h3>
                </div>
            </div>

            <!-- èŠ±é¦™éƒ¨åˆ† -->
            <div class="ingredient-category" id="floral">
                <!-- æ¸…æ–°èŠ±é¦™ - å‰è°ƒ -->
                <div class="ingredient-item" data-href="æ©™èŠ±.html" data-note="top" style="text-decoration:none;">
                    <img src="images/ingredients/æ©™èŠ±.jpeg" alt="æ©™èŠ± Orange Blossom" style="width:100%;height:80%;object-fit:cover;display:block;">
                    <div class="ingredient-bottom"></div>
                    <h3>æ©™èŠ±<br><span class='en'>Orange Blossom</span></h3>
                </div>
                <div class="ingredient-item" data-href="é“ƒå…°.html" data-note="top" style="text-decoration:none;">
                    <img src="images/ingredients/é“ƒå…°.jpeg" alt="é“ƒå…° Lily of the Valley" style="width:100%;height:80%;object-fit:cover;display:block;">
                    <div class="ingredient-bottom"></div>
                    <h3>é“ƒå…°<br><span class='en'>Lily of the Valley</span></h3>
                </div>
                <div class="ingredient-item" data-href="å°è‹å…°.html" data-note="top" style="text-decoration:none;">
                    <img src="images/ingredients/å°è‹å…°.jpeg" alt="å°è‹å…° Freesia" style="width:100%;height:80%;object-fit:cover;display:block;">
                    <div class="ingredient-bottom"></div>
                    <h3>å°è‹å…°<br><span class='en'>Freesia</span></h3>
                </div>
                <div class="ingredient-item" data-href="é£ä¿¡å­.html" data-note="top" style="text-decoration:none;">
                    <img src="images/ingredients/é£ä¿¡å­.jpeg" alt="é£ä¿¡å­ Hyacinth" style="width:100%;height:80%;object-fit:cover;display:block;">
                    <div class="ingredient-bottom"></div>
                    <h3>é£ä¿¡å­<br><span class='en'>Hyacinth</span></h3>
                </div>
                <div class="ingredient-item" data-href="é‡‘é“¶èŠ±.html" data-note="top" style="text-decoration:none;">
                    <img src="images/ingredients/é‡‘é“¶èŠ±.jpeg" alt="é‡‘é“¶èŠ± Honeysuckle" style="width:100%;height:80%;object-fit:cover;display:block;">
                    <div class="ingredient-bottom"></div>
                    <h3>é‡‘é“¶èŠ±<br><span class='en'>Honeysuckle</span></h3>
                </div>
                <div class="ingredient-item" data-href="æ¨±èŠ±.html" data-note="top" style="text-decoration:none;">
                    <img src="images/ingredients/æ¨±èŠ±.jpeg" alt="æ¨±èŠ± Sakura" style="width:100%;height:80%;object-fit:cover;display:block;">
                    <div class="ingredient-bottom"></div>
                    <h3>æ¨±èŠ±<br><span class='en'>Sakura</span></h3>
                </div>

                <!-- ç»å…¸èŠ±é¦™ - ä¸­è°ƒ -->
                <div class="ingredient-item" data-href="èŒ‰è‰.html" data-note="middle" style="text-decoration:none;">
                    <img src="images/ingredients/èŒ‰è‰.jpeg" alt="èŒ‰è‰" style="width:100%;height:80%;object-fit:cover;display:block;">
                    <div class="ingredient-bottom"></div>
                    <h3>èŒ‰è‰<br><span class='en'>Jasmine</span></h3>
                </div>
                <div class="ingredient-item" data-href="å¤§é©¬å£«é©ç«ç‘°.html" data-note="middle" style="text-decoration:none;">
                    <img src="images/ingredients/å¤§é©¬å£«é©ç«ç‘°.jpeg" alt="å¤§é©¬å£«é©ç«ç‘° Damask Rose" style="width:100%;height:80%;object-fit:cover;display:block;">
                    <div class="ingredient-bottom"></div>
                    <h3>å¤§é©¬å£«é©ç«ç‘°<br><span class='en'>Damask Rose</span></h3>
                </div>
                <div class="ingredient-item" data-href="åœŸè€³å…¶ç«ç‘°.html" data-note="middle" style="text-decoration:none;">
                    <img src="images/ingredients/åœŸè€³å…¶ç«ç‘°.jpeg" alt="åœŸè€³å…¶ç«ç‘° Turkish Rose" style="width:100%;height:80%;object-fit:cover;display:block;">
                    <div class="ingredient-bottom"></div>
                    <h3>åœŸè€³å…¶ç«ç‘°<br><span class='en'>Turkish Rose</span></h3>
                </div>
                <div class="ingredient-item" data-href="ä¿åŠ åˆ©äºšç«ç‘°.html" data-note="middle" style="text-decoration:none;">
                    <img src="images/ingredients/ä¿åŠ åˆ©äºšç«ç‘°.jpeg" alt="ä¿åŠ åˆ©äºšç«ç‘° Bulgarian Rose" style="width:100%;height:80%;object-fit:cover;display:block;">
                    <div class="ingredient-bottom"></div>
                    <h3>ä¿åŠ åˆ©äºšç«ç‘°<br><span class='en'>Bulgarian Rose</span></h3>
                </div>
                <div class="ingredient-item" data-href="ç™½å…°èŠ±.html" data-note="middle" style="text-decoration:none;">
                    <img src="images/ingredients/ç™½å…°èŠ±.jpeg" alt="ç™½å…°èŠ± Magnolia" style="width:100%;height:80%;object-fit:cover;display:block;">
                    <div class="ingredient-bottom"></div>
                    <h3>ç™½å…°èŠ±<br><span class='en'>Magnolia</span></h3>
                </div>
                <div class="ingredient-item" data-href="æ €å­èŠ±.html" data-note="middle" style="text-decoration:none;">
                    <img src="images/ingredients/æ €å­èŠ±.jpeg" alt="æ €å­èŠ± Gardenia" style="width:100%;height:80%;object-fit:cover;display:block;">
                    <div class="ingredient-bottom"></div>
                    <h3>æ €å­èŠ±<br><span class='en'>Gardenia</span></h3>
                </div>
                <div class="ingredient-item" data-href="ç´«ç½—å…°.html" data-note="middle" style="text-decoration:none;">
                    <img src="images/ingredients/ç´«ç½—å…°.jpeg" alt="ç´«ç½—å…° Violet" style="width:100%;height:80%;object-fit:cover;display:block;">
                    <div class="ingredient-bottom"></div>
                    <h3>ç´«ç½—å…°<br><span class='en'>Violet</span></h3>
                </div>
                <div class="ingredient-item" data-href="é‡‘åˆæ¬¢.html" data-note="middle" style="text-decoration:none;">
                    <img src="images/ingredients/é‡‘åˆæ¬¢.jpeg" alt="é‡‘åˆæ¬¢ Mimosa" style="width:100%;height:80%;object-fit:cover;display:block;">
                    <div class="ingredient-bottom"></div>
                    <h3>é‡‘åˆæ¬¢<br><span class='en'>Mimosa</span></h3>
                </div>
                <div class="ingredient-item" data-href="å‘æ—¥è‘µ.html" data-note="middle" style="text-decoration:none;">
                    <img src="images/ingredients/å‘æ—¥è‘µ.jpeg" alt="å‘æ—¥è‘µ Sunflower" style="width:100%;height:80%;object-fit:cover;display:block;">
                    <div class="ingredient-bottom"></div>
                    <h3>å‘æ—¥è‘µ<br><span class='en'>Sunflower</span></h3>
                </div>
                <div class="ingredient-item" data-href="é¸¡è›‹èŠ±.html" data-note="middle" style="text-decoration:none;">
                    <img src="images/ingredients/é¸¡è›‹èŠ±.jpeg" alt="æ¢”å­èŠ± Frangipani" style="width:100%;height:80%;object-fit:cover;display:block;">
                    <div class="ingredient-bottom"></div>
                    <h3>é¸¡è›‹èŠ±<br><span class='en'>Frangipani</span></h3>
                </div>
                <div class="ingredient-item" data-href="çº¢å§œèŠ±.html" data-note="middle" style="text-decoration:none;">
                    <img src="images/ingredients/çº¢å§œèŠ±.jpeg" alt="çº¢å§œèŠ± Ginger Lily" style="width:100%;height:80%;object-fit:cover;display:block;">
                    <div class="ingredient-bottom"></div>
                    <h3>çº¢å§œèŠ±<br><span class='en'>Ginger Lily</span></h3>
                </div>

                <!-- æµ“éƒèŠ±é¦™ - å°¾è°ƒ -->
                <div class="ingredient-item" data-href="å¤œæ¥é¦™.html" data-note="base" style="text-decoration:none;">
                    <img src="images/ingredients/å¤œæ¥é¦™.jpeg" alt="å¤œæ¥é¦™ Tuberose" style="width:100%;height:80%;object-fit:cover;display:block;">
                    <div class="ingredient-bottom"></div>
                    <h3>å¤œæ¥é¦™<br><span class='en'>Tuberose</span></h3>
                </div>
                <div class="ingredient-item" data-href="é¸¢å°¾èŠ±.html" data-note="base" style="text-decoration:none;">
                    <img src="images/ingredients/é¸¢å°¾èŠ±.jpeg" alt="é¸¢å°¾èŠ± Iris" style="width:100%;height:80%;object-fit:cover;display:block;">
                    <div class="ingredient-bottom"></div>
                    <h3>é¸¢å°¾èŠ±<br><span class='en'>Iris</span></h3>
                </div>
                <div class="ingredient-item" data-href="é¸³é¸¯èŒ‰è‰.html" data-note="base" style="text-decoration:none;">
                    <img src="images/ingredients/é¸³é¸¯èŒ‰è‰.jpeg" alt="é¸³é¸¯èŒ‰è‰ Ylang-Ylang" style="width:100%;height:80%;object-fit:cover;display:block;">
                    <div class="ingredient-bottom"></div>
                    <h3>é¸³é¸¯èŒ‰è‰<br><span class='en'>Ylang-Ylang</span></h3>
                </div>
            </div>

            <!-- æœ¨é¦™éƒ¨åˆ† -->
            <div class="ingredient-category" id="woody">
                <div class="ingredient-item" data-href="é›ªæ¾.html" data-note="base" style="text-decoration:none;">
                    <img src="images/ingredients/é›ªæ¾.jpeg" alt="é›ªæ¾ Cedarwood" style="width:100%;height:80%;object-fit:cover;display:block;">
                    <div class="ingredient-bottom"></div>
                    <h3>é›ªæ¾<br><span class='en'>Cedarwood</span></h3>
                </div>
                <div class="ingredient-item" data-href="æª€é¦™.html" data-note="base" style="text-decoration:none;">
                    <img src="images/ingredients/æª€é¦™.jpeg" alt="æª€é¦™ Sandalwood" style="width:100%;height:80%;object-fit:cover;display:block;">
                    <div class="ingredient-bottom"></div>
                    <h3>æª€é¦™<br><span class='en'>Sandalwood</span></h3>
                </div>
                <div class="ingredient-item" data-href="å²©å…°è‰.html" data-note="base" style="text-decoration:none;">
                    <img src="images/ingredients/å²©å…°è‰.jpeg" alt="å²©å…°è‰ Vetiver" style="width:100%;height:80%;object-fit:cover;display:block;">
                    <div class="ingredient-bottom"></div>
                    <h3>å²©å…°è‰<br><span class='en'>Vetiver</span></h3>
                </div>

                <div class="ingredient-item" data-href="å¤å·´é¦™è„‚æœ¨.html" data-note="base" style="text-decoration:none;">
                    <img src="images/ingredients/å¤å·´é¦™è„‚æœ¨.jpeg" alt="å¤å·´é¦™è„‚æœ¨ Guaiac Wood" style="width:100%;height:80%;object-fit:cover;display:block;">
                    <div class="ingredient-bottom"></div>
                    <h3>å¤å·´é¦™è„‚æœ¨<br><span class='en'>Guaiac Wood</span></h3>
                </div>

                <div class="ingredient-item" data-href="æ©¡æœ¨è‹”.html" data-note="base" style="text-decoration:none;">
                    <img src="images/ingredients/æ©¡æœ¨è‹”.jpeg" alt="æ©¡æœ¨è‹” Oakmoss" style="width:100%;height:80%;object-fit:cover;display:block;">
                    <div class="ingredient-bottom"></div>
                    <h3>æ©¡æœ¨è‹”<br><span class='en'>Oakmoss</span></h3>
                </div>
                <div class="ingredient-item" data-href="æ‰æœ¨.html" data-note="base" style="text-decoration:none;">
                    <img src="images/ingredients/æ‰æœ¨.jpeg" alt="æ‰æœ¨ Fir" style="width:100%;height:80%;object-fit:cover;display:block;">
                    <div class="ingredient-bottom"></div>
                    <h3>æ‰æœ¨<br><span class='en'>Fir</span></h3>
                </div>
                <div class="ingredient-item" data-href="æ¾æœ¨.html" data-note="base" style="text-decoration:none;">
                    <img src="images/ingredients/æ¾æœ¨.jpeg" alt="æ¾æœ¨ Pine" style="width:100%;height:80%;object-fit:cover;display:block;">
                    <div class="ingredient-bottom"></div>
                    <h3>æ¾æœ¨<br><span class='en'>Pine</span></h3>
                </div>
                <div class="ingredient-item" data-href="æŸæœ¨.html" data-note="base" style="text-decoration:none;">
                    <img src="images/ingredients/æŸæœ¨.jpeg" alt="æŸæœ¨ Cypress" style="width:100%;height:80%;object-fit:cover;display:block;">
                    <div class="ingredient-bottom"></div>
                    <h3>æŸæœ¨<br><span class='en'>Cypress</span></h3>
                </div>
                <div class="ingredient-item" data-href="å¹¿è—¿é¦™.html" data-note="base" style="text-decoration:none;">
                    <img src="images/ingredients/å¹¿è—¿é¦™.jpeg" alt="å¹¿è—¿é¦™ Patchouli" style="width:100%;height:80%;object-fit:cover;display:block;">
                    <div class="ingredient-bottom"></div>
                    <h3>å¹¿è—¿é¦™<br><span class='en'>Patchouli</span></h3>
                </div>
                <div class="ingredient-item" data-href="æ©¡è‹”.html" data-note="base" style="text-decoration:none;">
                    <img src="images/ingredients/æ©¡è‹”.jpeg" alt="æ©¡è‹” Oakmoss" style="width:100%;height:80%;object-fit:cover;display:block;">
                    <div class="ingredient-bottom"></div>
                    <h3>æ©¡è‹”<br><span class='en'>Oakmoss</span></h3>
                </div>
                <div class="ingredient-item" data-href="é›ªæ¾è‹”.html" data-note="base" style="text-decoration:none;">
                    <img src="images/ingredients/é›ªæ¾è‹”.jpeg" alt="é›ªæ¾è‹”è°ƒ Cedar Moss" style="width:100%;height:80%;object-fit:cover;display:block;">
                    <div class="ingredient-bottom"></div>
                    <h3>é›ªæ¾è‹”è°ƒ<br><span class='en'>Cedar Moss</span></h3>
                </div>
                <div class="ingredient-item" data-href="ä¹Œæœ¨.html" data-note="base" style="text-decoration:none;">
                    <img src="images/ingredients/ä¹Œæœ¨.jpeg" alt="ä¹Œæœ¨ Oud / Agarwood" style="width:100%;height:80%;object-fit:cover;display:block;">
                    <div class="ingredient-bottom"></div>
                    <h3>ä¹Œæœ¨/æ²‰é¦™<br><span class='en'>Oud / Agarwood</span></h3>
                </div>
                <div class="ingredient-item" data-href="æ¡¦æœ¨ç„¦æ²¹.html" data-note="base" style="text-decoration:none;">
                    <img src="images/ingredients/æ¡¦æœ¨ç„¦æ²¹.jpeg" alt="æ¡¦æœ¨ç„¦æ²¹ Birch Tar" style="width:100%;height:80%;object-fit:cover;display:block;">
                    <div class="ingredient-bottom"></div>
                    <h3>æ¡¦æœ¨ç„¦æ²¹<br><span class='en'>Birch Tar</span></h3>
                </div>





                <div class="ingredient-item" data-href="é›ªæ¾é†‡.html" data-note="base" style="text-decoration:none;">
                    <img src="images/ingredients/é›ªæ¾é†‡.jpeg" alt="é›ªæ¾é†‡ Cedrol" style="width:100%;height:80%;object-fit:cover;display:block;">
                    <div class="ingredient-bottom"></div>
                    <h3>é›ªæ¾é†‡<br><span class='en'>Cedrol</span></h3>
                </div>
            </div>
        </div>

        <!-- å·²é€‰é¦™æ–™å±•ç¤ºåŒº -->
        <div class="selected-ingredients">
            <h2>å·²é€‰æ‹©çš„é¦™æ–™</h2>
            <div class="action-buttons">
                <button id="generateStory" class="story-btn">ç”ŸæˆAIæ•…äº‹</button>
                <button id="generatePerfumeStory" class="perfume-story-btn">ç”Ÿæˆé¦™æ°´æ•…äº‹</button>
                <button id="debugBtn" class="debug-btn">è°ƒè¯•</button>
                <button id="clearAll" class="clear-btn">æ¸…ç©ºå…¨éƒ¨</button>
            </div>
            
            <!-- å‰è°ƒåŒºåŸŸ -->
            <div class="note-section">
                <h3>å‰è°ƒ Top Notes</h3>
                <div class="note-slots" data-note="top">
                    <div class="slot-item" data-index="0"><div class="placeholder">1</div></div>
                    <div class="slot-item" data-index="1"><div class="placeholder">2</div></div>
                    <div class="slot-item" data-index="2"><div class="placeholder">3</div></div>
                    <div class="slot-item" data-index="3"><div class="placeholder">4</div></div>
                    <div class="slot-item" data-index="4"><div class="placeholder">5</div></div>
                </div>
            </div>
            
            <!-- ä¸­è°ƒåŒºåŸŸ -->
            <div class="note-section">
                <h3>ä¸­è°ƒ Heart Notes</h3>
                <div class="note-slots" data-note="heart">
                    <div class="slot-item" data-index="0"><div class="placeholder">1</div></div>
                    <div class="slot-item" data-index="1"><div class="placeholder">2</div></div>
                    <div class="slot-item" data-index="2"><div class="placeholder">3</div></div>
                    <div class="slot-item" data-index="3"><div class="placeholder">4</div></div>
                    <div class="slot-item" data-index="4"><div class="placeholder">5</div></div>
                </div>
            </div>
            
            <!-- å°¾è°ƒåŒºåŸŸ -->
            <div class="note-section">
                <h3>å°¾è°ƒ Base Notes</h3>
                <div class="note-slots" data-note="base">
                    <div class="slot-item" data-index="0"><div class="placeholder">1</div></div>
                    <div class="slot-item" data-index="1"><div class="placeholder">2</div></div>
                    <div class="slot-item" data-index="2"><div class="placeholder">3</div></div>
                    <div class="slot-item" data-index="3"><div class="placeholder">4</div></div>
                    <div class="slot-item" data-index="4"><div class="placeholder">5</div></div>
                </div>
            </div>
            
            <!-- é¦™æ°´æ•…äº‹ç”ŸæˆåŒºåŸŸ -->
            <div class="perfume-story-section">
                <h3>é¦™æ°´æ•…äº‹</h3>
                <div id="perfume-story-container">
                    <div class="story-placeholder">
                        <p>é€‰æ‹©é¦™æ–™åï¼Œç‚¹å‡»"ç”Ÿæˆé¦™æ°´æ•…äº‹"æŒ‰é’®æ¥åˆ›ä½œæ‚¨çš„ä¸“å±é¦™æ°´æ•…äº‹</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // é¦™æ–™ç±»å‹ç­›é€‰åŠŸèƒ½
        document.querySelectorAll('.type-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                // ç§»é™¤æ‰€æœ‰activeç±»
                document.querySelectorAll('.type-btn').forEach(b => b.classList.remove('active'));
                // æ·»åŠ activeç±»åˆ°å½“å‰æŒ‰é’®
                btn.classList.add('active');
                
                const type = btn.dataset.type;
                const items = document.querySelectorAll('.ingredient-item');
                
                if (type === 'all') {
                    // æ˜¾ç¤ºæ‰€æœ‰é¦™æ
                    items.forEach(item => item.classList.remove('hidden'));
                } else {
                    // æ ¹æ®ç±»å‹ç­›é€‰é¦™æ
                    items.forEach(item => {
                        const category = item.closest('.ingredient-category');
                        if (category && category.id === type) {
                            item.classList.remove('hidden');
                        } else {
                            item.classList.add('hidden');
                        }
                    });
                }
            });
        });

        // é¦™è°ƒç­›é€‰åŠŸèƒ½
        document.querySelectorAll('.note-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                // ç§»é™¤æ‰€æœ‰activeç±»
                document.querySelectorAll('.note-btn').forEach(b => b.classList.remove('active'));
                // æ·»åŠ activeç±»åˆ°å½“å‰æŒ‰é’®
                btn.classList.add('active');
                
                const note = btn.dataset.note;
                const items = document.querySelectorAll('.ingredient-item');
                
                if (note === 'all') {
                    // æ˜¾ç¤ºæ‰€æœ‰é¦™æ
                    items.forEach(item => item.classList.remove('hidden'));
                } else {
                    // æ ¹æ®é¦™è°ƒç­›é€‰é¦™æ
                    items.forEach(item => {
                        if (item.dataset.note === note) {
                            item.classList.remove('hidden');
                        } else {
                            item.classList.add('hidden');
                        }
                    });
                }
            });
        });

        // é¦™æ–™ç›´æ¥é€‰æ‹©åŠŸèƒ½
        document.querySelectorAll('.ingredient-item').forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                console.log('=== é¦™æ–™ç‚¹å‡»äº‹ä»¶è§¦å‘ ===');
                
                // è·å–å½“å‰é€‰ä¸­çš„é¦™è°ƒ
                const activeNoteBtn = document.querySelector('.note-btn.active');
                const selectedNote = activeNoteBtn ? activeNoteBtn.dataset.note : 'all';
                console.log('å½“å‰é€‰ä¸­çš„é¦™è°ƒ:', selectedNote);
                
                // å¦‚æœé€‰æ‹©çš„æ˜¯"å…¨éƒ¨"ï¼Œåˆ™æç¤ºç”¨æˆ·é€‰æ‹©é¦™è°ƒ
                if (selectedNote === 'all') {
                    console.log('ç”¨æˆ·é€‰æ‹©äº†"å…¨éƒ¨"ï¼Œæ˜¾ç¤ºæç¤º');
                    showToast('è¯·å…ˆé€‰æ‹©é¦™è°ƒï¼ˆå‰è°ƒã€ä¸­è°ƒã€å°¾è°ƒï¼‰ï¼Œç„¶åå†ç‚¹å‡»é¦™æ–™');
                    return;
                }
                
                // è·å–é¦™æ–™ä¿¡æ¯
                const ingredientName = item.querySelector('h3').textContent.split('\n')[0];
                const ingredientImage = item.querySelector('img').src;
                console.log('ç‚¹å‡»çš„é¦™æ–™:', ingredientName);
                
                const ingredient = {
                    name: ingredientName,
                    image: ingredientImage.replace(window.location.origin + '/', '')
                };
                console.log('é¦™æ–™å¯¹è±¡:', ingredient);
                
                // å°†é¦™æ–™æ·»åŠ åˆ°é€‰ä¸­çš„é¦™è°ƒ
                const noteTypeMap = {
                    'top': 'top',
                    'middle': 'heart',
                    'base': 'base'
                };
                
                const noteType = noteTypeMap[selectedNote];
                console.log('æ˜ å°„åçš„é¦™è°ƒç±»å‹:', noteType);
                
                if (noteType) {
                    console.log('è°ƒç”¨addIngredientToSelectedNoteå‡½æ•°');
                    addIngredientToSelectedNote(ingredient, noteType);
                } else {
                    console.log('noteTypeæ˜ å°„å¤±è´¥');
                }
            });
        });

        (function(){
            // æ–°çš„æ•°æ®ç»“æ„ï¼šæŒ‰é¦™è°ƒåˆ†ç±»å­˜å‚¨
            function getSelectedIngredients() {
                try {
                    const data = JSON.parse(localStorage.getItem('selectedIngredientsByNote') || '{}');
                    return {
                        top: data.top || [],
                        heart: data.heart || [],
                        base: data.base || []
                    };
                } catch(e) {
                    return { top: [], heart: [], base: [] };
                }
            }
            
            function saveSelectedIngredients(data) {
                console.log('=== ä¿å­˜é¦™æ–™æ•°æ® ===');
                console.log('å‡†å¤‡ä¿å­˜çš„æ•°æ®:', data);
                console.log('æ•°æ®JSONå­—ç¬¦ä¸²:', JSON.stringify(data));
                localStorage.setItem('selectedIngredientsByNote', JSON.stringify(data));
                console.log('ä¿å­˜åçš„localStorage:', localStorage.getItem('selectedIngredientsByNote'));
                console.log('=== ä¿å­˜å®Œæˆ ===');
            }
            
            // æ¸²æŸ“å·²é€‰é¦™æ–™
            function renderSelectedIngredients() {
                const selected = getSelectedIngredients();
                
                // æ·»åŠ è°ƒè¯•ä¿¡æ¯
                console.log('æ¸²æŸ“å·²é€‰é¦™æ–™:', selected);
                console.log('å‰è°ƒæ•°æ®:', selected.top);
                console.log('ä¸­è°ƒæ•°æ®:', selected.heart);
                console.log('å°¾è°ƒæ•°æ®:', selected.base);
                
                // é¦–å…ˆæ¸…é™¤æ‰€æœ‰é¦™æ–™é¡¹çš„é€‰ä¸­çŠ¶æ€
                document.querySelectorAll('.ingredient-item').forEach(item => {
                    item.classList.remove('selected');
                });
                
                // é«˜äº®æ˜¾ç¤ºå·²é€‰æ‹©çš„é¦™æ–™
                const allSelectedIngredients = [...selected.top, ...selected.heart, ...selected.base];
                allSelectedIngredients.forEach(ingredient => {
                    const ingredientItem = Array.from(document.querySelectorAll('.ingredient-item')).find(item => {
                        const name = item.querySelector('h3').textContent.split('\n')[0];
                        return name === ingredient.name;
                    });
                    if (ingredientItem) {
                        ingredientItem.classList.add('selected');
                    }
                });
                
                ['top', 'heart', 'base'].forEach(noteType => {
                    // è°ƒè¯•ï¼šæŸ¥çœ‹æ‰€æœ‰data-noteå±æ€§çš„å…ƒç´ 
                    const allDataNoteElements = document.querySelectorAll('[data-note]');
                    console.log(`æ‰€æœ‰data-noteå…ƒç´ :`, allDataNoteElements);
                    allDataNoteElements.forEach(el => {
                        console.log(`å…ƒç´ :`, el, `data-noteå€¼:`, el.getAttribute('data-note'));
                    });
                    
                    // ä¿®å¤ï¼šä¸“é—¨æŸ¥æ‰¾note-slotsç±»çš„æ’æ§½å®¹å™¨
                    const noteSlots = document.querySelector(`.note-slots[data-note="${noteType}"]`);
                    console.log(`æŸ¥æ‰¾ ${noteType} æ’æ§½å®¹å™¨:`, noteSlots);
                    
                    if (!noteSlots) {
                        console.warn(`æ‰¾ä¸åˆ° ${noteType} çš„æ’æ§½å®¹å™¨`);
                        return;
                    }
                    
                    const slots = noteSlots.querySelectorAll('.slot-item');
                    const ingredients = selected[noteType] || [];
                    
                    console.log(`${noteType} é¦™è°ƒæœ‰ ${ingredients.length} ä¸ªé¦™æ–™:`, ingredients);
                    console.log(`${noteType} æ‰¾åˆ° ${slots.length} ä¸ªæ’æ§½`);
                    
                    slots.forEach((slot, index) => {
                        const ingredient = ingredients[index];
                        console.log(`${noteType} æ’æ§½ ${index}:`, ingredient);
                        
                        slot.innerHTML = '';
                        
                        if (ingredient) {
                            console.log(`æ¸²æŸ“ ${noteType} æ’æ§½ ${index} çš„é¦™æ–™:`, ingredient.name);
                            console.log(`é¦™æ–™å›¾ç‰‡è·¯å¾„:`, ingredient.image);
                            
                            // æœ‰é¦™æ–™æ—¶æ˜¾ç¤ºå›¾ç‰‡
                            const img = document.createElement('img');
                            // ç¡®ä¿å›¾ç‰‡è·¯å¾„æ­£ç¡®
                            const imgPath = ingredient.image.startsWith('/') ? ingredient.image : '/' + ingredient.image;
                            console.log(`æœ€ç»ˆå›¾ç‰‡è·¯å¾„:`, imgPath);
                            img.src = imgPath;
                            img.alt = ingredient.name;
                            img.title = `ç‚¹å‡»æŸ¥çœ‹ ${ingredient.name} è¯¦æƒ…`;
                            img.style.cursor = 'pointer';
                            img.addEventListener('click', () => {
                                window.location.href = ingredient.name + '.html';
                            });
                            
                            // æ·»åŠ åˆ é™¤æŒ‰é’®
                            const removeBtn = document.createElement('button');
                            removeBtn.className = 'remove-btn';
                            removeBtn.innerHTML = 'Ã—';
                            removeBtn.title = 'ç§»é™¤é¦™æ–™';
                            removeBtn.addEventListener('click', (e) => {
                                e.stopPropagation();
                                removeIngredient(noteType, index);
                            });
                            
                            slot.appendChild(img);
                            slot.appendChild(removeBtn);
                            slot.classList.add('filled');
                        } else {
                            // ç©ºä½æ˜¾ç¤ºå ä½ç¬¦
                            const placeholder = document.createElement('div');
                            placeholder.className = 'placeholder';
                            placeholder.textContent = index + 1;
                            slot.appendChild(placeholder);
                            slot.classList.remove('filled');
                        }
                    });
                });
            }
            
            // ç§»é™¤é¦™æ–™
            function removeIngredient(noteType, index) {
                const selected = getSelectedIngredients();
                selected[noteType].splice(index, 1);
                saveSelectedIngredients(selected);
                renderSelectedIngredients();
                
                // æ˜¾ç¤ºæç¤º
                const noteNames = { top: 'å‰è°ƒ', heart: 'ä¸­è°ƒ', base: 'å°¾è°ƒ' };
                alert(`å·²ä»${noteNames[noteType]}ä¸­ç§»é™¤é¦™æ–™`);
            }
            
            // æ¸…ç©ºæ‰€æœ‰é¦™æ–™
            function clearAllIngredients() {
                if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å·²é€‰æ‹©çš„é¦™æ–™å—ï¼Ÿ')) {
                    const emptyData = { top: [], heart: [], base: [] };
                    saveSelectedIngredients(emptyData);
                    renderSelectedIngredients();
                    alert('å·²æ¸…ç©ºæ‰€æœ‰é¦™æ–™é€‰æ‹©');
                }
            }
            
            // ç”ŸæˆAIæ•…äº‹
            function generateAIStory() {
                const selected = getSelectedIngredients();
                const allIngredients = [...selected.top, ...selected.heart, ...selected.base];
                
                if (allIngredients.length === 0) {
                    alert('è¯·å…ˆé€‰æ‹©ä¸€äº›é¦™æ–™ï¼');
                    return;
                }
                
                console.log('=== ç”ŸæˆAIæ•…äº‹ ===');
                console.log('é€‰ä¸­çš„é¦™æ–™æ•°æ®:', selected);
                console.log('æ‰€æœ‰é¦™æ–™:', allIngredients);
                
                // è½¬æ¢æ•°æ®æ ¼å¼ä¸ºAIæ•…äº‹ç”Ÿæˆå™¨æ‰€éœ€çš„æ ¼å¼
                const storyIngredients = allIngredients.map((ingredient, index) => ({
                    id: `ingredient_${index}`,
                    name: ingredient.name,
                    image: ingredient.image,
                    ratio: 0 // åˆå§‹æ¯”ä¾‹ä¸º0ï¼Œç”¨æˆ·å¯åœ¨æ•…äº‹ç”Ÿæˆé¡µé¢è°ƒæ•´
                }));
                
                console.log('è½¬æ¢åçš„é¦™æ–™æ•°æ®:', storyIngredients);
                
                // ä¿å­˜åˆ°localStorageä¾›AIæ•…äº‹ç”Ÿæˆå™¨ä½¿ç”¨
                localStorage.setItem('selectedIngredients', JSON.stringify(storyIngredients));
                console.log('å·²ä¿å­˜åˆ°selectedIngredients');
                
                // åŒæ—¶ä¿å­˜åŸå§‹æ ¼å¼åˆ°selectedIngredientsByNoteï¼ˆä»¥é˜²ä¸‡ä¸€ï¼‰
                localStorage.setItem('selectedIngredientsByNote', JSON.stringify(selected));
                console.log('å·²ä¿å­˜åˆ°selectedIngredientsByNote');
                
                // é€šè¿‡URLå‚æ•°ä¼ é€’é¦™æ–™æ•°æ®
                const ingredientsParam = encodeURIComponent(JSON.stringify(storyIngredients));
                const url = `http://localhost:8080/static/scent_story_generator.html?ingredients=${ingredientsParam}`;
                console.log('è·³è½¬URL:', url);
                
                // è·³è½¬åˆ°AIæ•…äº‹ç”Ÿæˆé¡µé¢
                window.open(url, '_blank');
            }
            
            // ç”Ÿæˆé¦™æ°´æ•…äº‹ï¼ˆæ–°åŠŸèƒ½ï¼‰
            async function generatePerfumeStory() {
                const selected = getSelectedIngredients();
                const allIngredients = [...selected.top, ...selected.heart, ...selected.base];
                
                if (allIngredients.length === 0) {
                    alert('è¯·å…ˆé€‰æ‹©ä¸€äº›é¦™æ–™ï¼');
                    return;
                }
                
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                const storyContainer = document.getElementById('perfume-story-container');
                storyContainer.innerHTML = `
                    <div class="story-loading">
                        <h3>æ­£åœ¨åˆ›ä½œæ‚¨çš„é¦™æ°´æ•…äº‹...</h3>
                        <p>AIæ­£åœ¨æ ¹æ®æ‚¨é€‰æ‹©çš„é¦™æ–™ç»„åˆæ„æ€ä¸€ä¸ªç‹¬ç‰¹çš„é¦™æ°´æ•…äº‹</p>
                        <div class="loading-spinner"></div>
                    </div>
                `;
                
                try {
                    // å‡†å¤‡é¦™æ–™æ•°æ®
                    const ingredients = allIngredients.map(ingredient => ingredient.name);
                    
                    // è°ƒç”¨APIç”Ÿæˆæ•…äº‹
                    const response = await fetch('http://localhost:8080/api/generate', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            ingredients: ingredients,
                            aiProvider: 'openai'
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const storyData = await response.json();
                    
                    if (storyData.error) {
                        throw new Error(storyData.error);
                    }
                    
                    // æ˜¾ç¤ºç”Ÿæˆçš„æ•…äº‹
                    storyContainer.innerHTML = `
                        <div class="story-result">
                            <h3>${storyData.title}</h3>
                            <div class="story-content">
                                ${storyData.content.replace(/\n/g, '<br>')}
                            </div>
                            <div class="story-meta">
                                <span class="story-time">ç”Ÿæˆæ—¶é—´: ${new Date(storyData.generated_at * 1000).toLocaleString()}</span>
                                <span class="story-ai">AI: ChatGPT</span>
                            </div>
                            <button onclick="generatePerfumeStory()" class="btn btn-primary">é‡æ–°ç”Ÿæˆ</button>
                        </div>
                    `;
                    
                } catch (error) {
                    console.error('ç”Ÿæˆé¦™æ°´æ•…äº‹å¤±è´¥:', error);
                    storyContainer.innerHTML = `
                        <div class="story-error">
                            <h3>æ•…äº‹ç”Ÿæˆå¤±è´¥</h3>
                            <p>é”™è¯¯ä¿¡æ¯: ${error.message}</p>
                            <p>è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–ç¨åå†è¯•</p>
                            <button onclick="generatePerfumeStory()" class="btn btn-primary">é‡è¯•</button>
                        </div>
                    `;
                }
            }
            
            // æ·»åŠ é¦™æ–™åˆ°æŒ‡å®šé¦™è°ƒ
            function addIngredientToNote(ingredient, noteType) {
                const selected = getSelectedIngredients();
                const noteIngredients = selected[noteType];
                
                // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
                const exists = noteIngredients.some(item => item.name === ingredient.name);
                if (exists) {
                    alert('è¯¥é¦™æ–™å·²åœ¨æ­¤é¦™è°ƒä¸­');
                    return false;
                }
                
                // æ£€æŸ¥æ˜¯å¦å·²æ»¡
                if (noteIngredients.length >= 5) {
                    alert('è¯¥é¦™è°ƒå·²æ»¡ï¼Œæœ€å¤šåªèƒ½é€‰æ‹©5ç§é¦™æ–™');
                    return false;
                }
                
                // æ·»åŠ é¦™æ–™
                noteIngredients.push(ingredient);
                console.log('=== æ·»åŠ é¦™æ–™å ===');
                console.log('å½“å‰é¦™è°ƒæ•°æ®:', selected);
                console.log('æ·»åŠ çš„é¦™æ–™:', ingredient);
                saveSelectedIngredients(selected);
                renderSelectedIngredients();
                
                const noteNames = { top: 'å‰è°ƒ', heart: 'ä¸­è°ƒ', base: 'å°¾è°ƒ' };
                alert(`å·²å°† ${ingredient.name} æ·»åŠ åˆ°${noteNames[noteType]} (${noteIngredients.length}/5)`);
                return true;
            }
            
            // æ·»åŠ é¦™æ–™åˆ°é€‰ä¸­çš„é¦™è°ƒï¼ˆç”¨äºä¸»é¡µé¢ç›´æ¥é€‰æ‹©ï¼‰
            function addIngredientToSelectedNote(ingredient, noteType) {
                const selected = getSelectedIngredients();
                
                // æ£€æŸ¥æ˜¯å¦å·²ç»åœ¨å…¶ä»–é¦™è°ƒä¸­é€‰æ‹©äº†è¿™ä¸ªé¦™æ–™
                let existingNote = null;
                for (const [note, ingredients] of Object.entries(selected)) {
                    if (ingredients.some(item => item.name === ingredient.name)) {
                        existingNote = note;
                        break;
                    }
                }
                
                // å¦‚æœå·²ç»åœ¨å…¶ä»–é¦™è°ƒä¸­ï¼Œå…ˆç§»é™¤
                if (existingNote && existingNote !== noteType) {
                    const index = selected[existingNote].findIndex(item => item.name === ingredient.name);
                    if (index > -1) {
                        selected[existingNote].splice(index, 1);
                    }
                }
                
                const noteIngredients = selected[noteType];
                
                // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨äºè¯¥é¦™è°ƒ
                const exists = noteIngredients.some(item => item.name === ingredient.name);
                if (exists) {
                    // å¦‚æœå·²å­˜åœ¨ï¼Œåˆ™ç§»é™¤ï¼ˆå–æ¶ˆé€‰æ‹©ï¼‰
                    const index = noteIngredients.findIndex(item => item.name === ingredient.name);
                    noteIngredients.splice(index, 1);
                    saveSelectedIngredients(selected);
                    renderSelectedIngredients();
                    
                    const noteNames = { top: 'å‰è°ƒ', heart: 'ä¸­è°ƒ', base: 'å°¾è°ƒ' };
                    showToast(`å·²ä»${noteNames[noteType]}ä¸­ç§»é™¤ ${ingredient.name}`);
                    return;
                }
                
                // æ£€æŸ¥æ˜¯å¦å·²æ»¡
                if (noteIngredients.length >= 5) {
                    showToast('è¯¥é¦™è°ƒå·²æ»¡ï¼Œæœ€å¤šåªèƒ½é€‰æ‹©5ç§é¦™æ–™');
                    return;
                }
                
                // æ·»åŠ é¦™æ–™
                noteIngredients.push(ingredient);
                saveSelectedIngredients(selected);
                renderSelectedIngredients();
                
                const noteNames = { top: 'å‰è°ƒ', heart: 'ä¸­è°ƒ', base: 'å°¾è°ƒ' };
                showToast(`å·²å°† ${ingredient.name} æ·»åŠ åˆ°${noteNames[noteType]} (${noteIngredients.length}/5)`);
            }
            
            // æ˜¾ç¤ºæç¤ºä¿¡æ¯
            function showToast(message) {
                // ç§»é™¤å·²å­˜åœ¨çš„æç¤º
                const existingToast = document.querySelector('.toast-message');
                if (existingToast) {
                    existingToast.remove();
                }
                
                const toast = document.createElement('div');
                toast.className = 'toast-message';
                toast.textContent = message;
                toast.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: #28a745;
                    color: white;
                    padding: 12px 20px;
                    border-radius: 4px;
                    z-index: 1000;
                    font-size: 14px;
                    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
                    transform: translateX(100%);
                    transition: transform 0.3s ease;
                `;
                
                document.body.appendChild(toast);
                
                // æ˜¾ç¤ºåŠ¨ç”»
                setTimeout(() => {
                    toast.style.transform = 'translateX(0)';
                }, 10);
                
                // 3ç§’åéšè—
                setTimeout(() => {
                    toast.style.transform = 'translateX(100%)';
                    setTimeout(() => toast.remove(), 300);
                }, 3000);
            }
            
            // ä»æ—§æ ¼å¼è¿ç§»æ•°æ®
            function migrateOldData() {
                const oldData = localStorage.getItem('selectedIngredients');
                if (oldData) {
                    try {
                        const ingredients = JSON.parse(oldData);
                        if (ingredients.length > 0) {
                            // å°†æ—§æ•°æ®æ¸…ç©ºï¼Œç”¨æˆ·éœ€è¦é‡æ–°é€‰æ‹©å¹¶æŒ‡å®šé¦™è°ƒ
                            localStorage.removeItem('selectedIngredients');
                            console.log('å·²æ¸…ç†æ—§çš„é€‰æ‹©æ•°æ®ï¼Œè¯·é‡æ–°é€‰æ‹©é¦™æ–™å¹¶æŒ‡å®šé¦™è°ƒ');
                        }
                    } catch(e) {}
                }
            }

            // å¯¼å‡ºå‡½æ•°åˆ°å…¨å±€
            window.renderSelectedIngredients = renderSelectedIngredients;
            window.clearAllIngredients = clearAllIngredients;
            window.addIngredientToNote = addIngredientToNote;
            window.getSelectedIngredients = getSelectedIngredients;
            
            // åˆå§‹åŒ–
            migrateOldData();
            renderSelectedIngredients();
            
            // ç»‘å®šæ¸…ç©ºæŒ‰é’®äº‹ä»¶
            document.getElementById('clearAll').addEventListener('click', clearAllIngredients);
            
            // ç»‘å®šè°ƒè¯•æŒ‰é’®äº‹ä»¶
            document.getElementById('debugBtn').addEventListener('click', function() {
                const data = getSelectedIngredients();
                console.log('å½“å‰localStorageæ•°æ®:', data);
                alert('å½“å‰localStorageæ•°æ®:\n' + JSON.stringify(data, null, 2));
                
                // å¼ºåˆ¶é‡æ–°æ¸²æŸ“
                renderSelectedIngredients();
            });
            
            // ç»‘å®šç”ŸæˆAIæ•…äº‹æŒ‰é’®äº‹ä»¶
            document.getElementById('generateStory').addEventListener('click', generateAIStory);
            
            // ç»‘å®šç”Ÿæˆé¦™æ°´æ•…äº‹æŒ‰é’®äº‹ä»¶
            document.getElementById('generatePerfumeStory').addEventListener('click', generatePerfumeStory);
            
            // é¡µé¢åŠ è½½æ—¶åŒæ­¥é€‰æ‹©çŠ¶æ€
            document.addEventListener('DOMContentLoaded', function() {
                renderSelectedIngredients();
            });
            
            // ç›‘å¬localStorageå˜åŒ–ï¼Œå®æ—¶æ›´æ–°æ˜¾ç¤º
            window.addEventListener('storage', function(e) {
                if (e.key === 'selectedIngredientsByNote') {
                    renderSelectedIngredients();
                }
                if (e.key === 'selectedIngredientsByNote_trigger') {
                    console.log('æ”¶åˆ°è§¦å‘å™¨ä¿¡å·ï¼Œé‡æ–°æ¸²æŸ“é€‰æ‹©çŠ¶æ€');
                    renderSelectedIngredients();
                }
            });
            
            // ç›‘å¬é¡µé¢ç„¦ç‚¹æ¢å¤ï¼Œé‡æ–°æ¸²æŸ“é€‰æ‹©çŠ¶æ€
            window.addEventListener('focus', function() {
                console.log('é¡µé¢æ¢å¤ç„¦ç‚¹ï¼Œé‡æ–°æ¸²æŸ“é€‰æ‹©çŠ¶æ€');
                renderSelectedIngredients();
            });
            
            // ç›‘å¬é¡µé¢å¯è§æ€§å˜åŒ–
            document.addEventListener('visibilitychange', function() {
                if (!document.hidden) {
                    console.log('é¡µé¢å˜ä¸ºå¯è§ï¼Œé‡æ–°æ¸²æŸ“é€‰æ‹©çŠ¶æ€');
                    renderSelectedIngredients();
                }
            });
            
            // å®šæœŸæ£€æŸ¥localStorageå˜åŒ–ï¼ˆå¤‡ç”¨æ–¹æ¡ˆï¼‰
            let lastDataString = JSON.stringify(getSelectedIngredients());
            setInterval(function() {
                const currentDataString = JSON.stringify(getSelectedIngredients());
                if (currentDataString !== lastDataString) {
                    console.log('æ£€æµ‹åˆ°localStorageæ•°æ®å˜åŒ–ï¼Œé‡æ–°æ¸²æŸ“');
                    renderSelectedIngredients();
                    lastDataString = currentDataString;
                }
            }, 1000); // æ¯ç§’æ£€æŸ¥ä¸€æ¬¡
        })();
    </script>
    <script src="perfume-workshop/static/scent_story_interaction.js"></script>
</body>
</html> 